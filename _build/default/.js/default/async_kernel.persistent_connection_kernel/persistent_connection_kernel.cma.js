// Generated by js_of_ocaml
//# buildInfo:effects=false, kind=cma, use-js-string=true, version=5.6.0

//# unitInfo: Provides: Persistent_connection_kernel__
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    Persistent_connection_kernel = [0],
    Persistent_connection_kernel$0 = [0, Persistent_connection_kernel];
   runtime.caml_register_global
    (0, Persistent_connection_kernel$0, "Persistent_connection_kernel__");
   return;
  }
  (globalThis));

//# unitInfo: Provides: Persistent_connection_kernel__Event
//# unitInfo: Requires: Ppx_bench_lib__Benchmark_accumulator, Ppx_expect_runtime, Ppx_inline_test_lib, Ppx_module_timer_runtime, Sexplib0__Sexp_conv
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Persistent_connection_kern$0 = "Persistent_connection_kernel__Event",
    cst_persistent_connection_kern$0 = "persistent_connection_kernel";
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    Sexplib0_Sexp_conv = global_data.Sexplib0__Sexp_conv,
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Ppx_expect_runtime = global_data.Ppx_expect_runtime,
    Ppx_inline_test_lib = global_data.Ppx_inline_test_lib;
   caml_call1(Ppx_module_timer_runtime[4], cst_Persistent_connection_kern$0);
   caml_call1
    (Ppx_bench_lib_Benchmark_accumu[1][1], cst_persistent_connection_kern$0);
   caml_call1
    (Ppx_expect_runtime[1][1], "persistent_connection_kernel/src/event.ml");
   caml_call2
    (Ppx_inline_test_lib[6], cst_persistent_connection_kern$0, "event.ml");
   var
    _a_ = [0, "Attempting_to_connect"],
    _b_ = [0, "Disconnected"],
    _c_ = [0, "Obtained_address"],
    _d_ = [0, "Failed_to_connect"],
    _e_ = [0, "Connected"],
    cst_persistent_connection_kern = cst_persistent_connection_kern$0,
    cst_Persistent_connection_kern = cst_Persistent_connection_kern$0;
   function sexp_of_t(of_conn_001, of_conn_error_002, of_address_003, param){
    if(typeof param === "number") return 0 === param ? _a_ : _b_;
    switch(param[0]){
      case 0:
       var
        arg0_004 = param[1],
        res0_005 = caml_call1(of_address_003, arg0_004);
       return [1, [0, _c_, [0, res0_005, 0]]];
      case 1:
       var
        arg0_006 = param[1],
        res0_007 = caml_call1(of_conn_error_002, arg0_006);
       return [1, [0, _d_, [0, res0_007, 0]]];
      default:
       var
        arg0_008 = param[1],
        res0_009 = caml_call1(Sexplib0_Sexp_conv[23], arg0_008);
       return [1, [0, _e_, [0, res0_009, 0]]];
    }
   }
   function log_level(param){
    if(typeof param !== "number" && 1 === param[0]) return 106380200;
    return 815031438;
   }
   caml_call1(Ppx_inline_test_lib[7], cst_persistent_connection_kern);
   caml_call1(Ppx_expect_runtime[1][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Persistent_connection_kern);
   var Persistent_connection_kernel_E = [0, sexp_of_t, log_level];
   runtime.caml_register_global
    (17, Persistent_connection_kernel_E, cst_Persistent_connection_kern$0);
   return;
  }
  (globalThis));

//# unitInfo: Provides: Persistent_connection_kernel__Persistent_connection_kernel_intf
//# unitInfo: Requires: Ppx_bench_lib__Benchmark_accumulator, Ppx_expect_runtime, Ppx_inline_test_lib, Ppx_module_timer_runtime
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Persistent_connection_kern =
      "Persistent_connection_kernel__Persistent_connection_kernel_intf",
    cst_persistent_connection_kern = "persistent_connection_kernel";
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Ppx_expect_runtime = global_data.Ppx_expect_runtime,
    Ppx_inline_test_lib = global_data.Ppx_inline_test_lib;
   caml_call1(Ppx_module_timer_runtime[4], cst_Persistent_connection_kern);
   caml_call1
    (Ppx_bench_lib_Benchmark_accumu[1][1], cst_persistent_connection_kern);
   caml_call1
    (Ppx_expect_runtime[1][1],
     "persistent_connection_kernel/src/persistent_connection_kernel_intf.ml");
   caml_call2
    (Ppx_inline_test_lib[6],
     cst_persistent_connection_kern,
     "persistent_connection_kernel_intf.ml");
   caml_call1(Ppx_inline_test_lib[7], cst_persistent_connection_kern);
   caml_call1(Ppx_expect_runtime[1][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Persistent_connection_kern);
   var Persistent_connection_kernel_P = [0];
   runtime.caml_register_global
    (11, Persistent_connection_kernel_P, cst_Persistent_connection_kern);
   return;
  }
  (globalThis));

//# unitInfo: Provides: Persistent_connection_kernel
//# unitInfo: Requires: Async_kernel, Async_kernel__Deferred, Async_kernel__Deferred_or_error, Async_kernel__Ivar, Async_kernel__Monitor, Async_kernel__Time_source, Base__Exn, Base__Random, Bus, Core, Core__Error, Core__Fn, Core__Option, Core__Or_error, Core__Result, Core__Sexp, Core__Time_ns, Persistent_connection_kernel__Event, Persistent_connection_kernel__Persistent_connection_kernel_intf, Ppx_bench_lib__Benchmark_accumulator, Ppx_expect_runtime, Ppx_inline_test_lib, Ppx_module_timer_runtime, Sexplib0__Sexp_conv
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Persistent_connection_kern$0 = "Persistent_connection_kernel",
    cst_persistent_connection_kern$1 = "persistent_connection_kernel",
    cst_persistent_connection_kern$0 =
      "persistent_connection_kernel/src/persistent_connection_kernel.ml";
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   function caml_call3(f, a0, a1, a2){
    return (f.l >= 0 ? f.l : f.l = f.length) == 3
            ? f(a0, a1, a2)
            : runtime.caml_call_gen(f, [a0, a1, a2]);
   }
   function caml_call4(f, a0, a1, a2, a3){
    return (f.l >= 0 ? f.l : f.l = f.length) == 4
            ? f(a0, a1, a2, a3)
            : runtime.caml_call_gen(f, [a0, a1, a2, a3]);
   }
   function caml_call5(f, a0, a1, a2, a3, a4){
    return (f.l >= 0 ? f.l : f.l = f.length) == 5
            ? f(a0, a1, a2, a3, a4)
            : runtime.caml_call_gen(f, [a0, a1, a2, a3, a4]);
   }
   function caml_call6(f, a0, a1, a2, a3, a4, a5){
    return (f.l >= 0 ? f.l : f.l = f.length) == 6
            ? f(a0, a1, a2, a3, a4, a5)
            : runtime.caml_call_gen(f, [a0, a1, a2, a3, a4, a5]);
   }
   var
    undef = undefined,
    global_data = runtime.caml_get_global_data(),
    dummy_src_pos_that_shows_up_in =
      [0, cst_persistent_connection_kern$0, 19, 560, 603],
    Core_Error = global_data.Core__Error,
    Bus = global_data.Bus,
    Async_kernel_Ivar = global_data.Async_kernel__Ivar,
    Async_kernel = global_data.Async_kernel,
    Core_Result = global_data.Core__Result,
    Async_kernel_Deferred = global_data.Async_kernel__Deferred,
    Sexplib0_Sexp_conv = global_data.Sexplib0__Sexp_conv,
    Async_kernel_Time_source = global_data.Async_kernel__Time_source,
    Core_Time_ns = global_data.Core__Time_ns,
    Base_Random = global_data.Base__Random,
    Core = global_data.Core,
    Core_Fn = global_data.Core__Fn,
    Core_Option = global_data.Core__Option,
    Async_kernel_Deferred_or_error =
      global_data.Async_kernel__Deferred_or_error,
    Async_kernel_Monitor = global_data.Async_kernel__Monitor,
    Base_Exn = global_data.Base__Exn,
    Core_Sexp = global_data.Core__Sexp,
    Persistent_connection_kernel_E =
      global_data.Persistent_connection_kernel__Event,
    Core_Or_error = global_data.Core__Or_error,
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Ppx_expect_runtime = global_data.Ppx_expect_runtime,
    Ppx_inline_test_lib = global_data.Ppx_inline_test_lib;
   caml_call1(Ppx_module_timer_runtime[4], cst_Persistent_connection_kern$0);
   caml_call1
    (Ppx_bench_lib_Benchmark_accumu[1][1], cst_persistent_connection_kern$1);
   caml_call1(Ppx_expect_runtime[1][1], cst_persistent_connection_kern$0);
   caml_call2
    (Ppx_inline_test_lib[6],
     cst_persistent_connection_kern$1,
     "persistent_connection_kernel.ml");
   var
    cst_Persistent_connection_clos = "Persistent connection closed",
    _w_ = [0, -289386606, 0],
    _x_ = [0, -289386606, 0],
    _y_ = [0, 990972795, 0],
    _u_ = [0, -289386606, 0],
    _v_ = [0, -289386606, 0],
    _z_ = [0, cst_persistent_connection_kern$0, 222, 8142, 8223],
    _t_ = [0, 0],
    _n_ = [0, "Close_started"],
    _o_ = [0, "Ok"],
    _f_ = [0, "sexp_of_address"],
    _g_ = [0, "address_equal"],
    _h_ = [0, "don't_reconnect"],
    _i_ = [0, "close_finished"],
    _j_ = [0, "close_started"],
    _k_ = [0, "event_bus"],
    _l_ = [0, "event_handler"],
    _m_ = [0, "next_connect_result"],
    _p_ = [0, "conn"],
    _q_ = [0, "retry_delay"],
    _r_ = [0, "connect"],
    _s_ = [0, "get_address"],
    _d_ = [0, "Conn_error"],
    _e_ = [0, "Exception"],
    _c_ = [0, "<Conn.t>"],
    _a_ = [0, "on_event"],
    _b_ = [0, "server_name"],
    cst_persistent_connection_kern = cst_persistent_connection_kern$1,
    cst_Persistent_connection_kern = cst_Persistent_connection_kern$0;
   function Make(Conn_err, Conn){
    var close = Conn[1], is_closed = Conn[2], close_finished = Conn[3];
    function sexp_of_t(param){return _c_;}
    var
     Conn$0 = [0, close, is_closed, close_finished, sexp_of_t],
     sexp_of_conn_error = Conn_err[2];
    function sexp_of_t$0(of_address_009, x_010){
     return caml_call4
             (Persistent_connection_kernel_E[1],
              Conn$0[4],
              Conn_err[2],
              of_address_009,
              x_010);
    }
    var Event = [0, sexp_of_t$0];
    function sexp_of_t$1(param){
     if(0 === param[0]){
      var
       arg0_011 = param[1],
       res0_012 = caml_call1(sexp_of_conn_error, arg0_011);
      return [1, [0, _d_, [0, res0_012, 0]]];
     }
     var arg0_013 = param[1], res0_014 = caml_call1(Core_Error[9], arg0_013);
     return [1, [0, _e_, [0, res0_014, 0]]];
    }
    function same_error(e1, e2){
     function to_sexp(e){
      var
       _a$_ = caml_call1(Core_Error[28], e),
       _ba_ = caml_call1(Async_kernel_Monitor[13], _a$_);
      return caml_call1(Base_Exn[1], _ba_);
     }
     var _a9_ = to_sexp(e2), _a__ = to_sexp(e1);
     return caml_call2(Core_Sexp[39], _a__, _a9_);
    }
    function equal(e1, e2){
     if(0 === e1[0]){
      var e1$0 = e1[1];
      if(0 === e2[0]){
       var e2$0 = e2[1];
       return caml_call2(Conn_err[1], e1$0, e2$0);
      }
     }
     else{
      var e1$1 = e1[1];
      if(0 !== e2[0]){var e2$1 = e2[1]; return same_error(e1$1, e2$1);}
     }
     return 0;
    }
    function join(param){
     if(0 !== param[0]){var exn = param[1]; return [1, [1, exn]];}
     var match = param[1];
     if(0 === match[0]){var result = match[1]; return [0, result];}
     var conn_error = match[1];
     return [1, [0, conn_error]];
    }
    function to_conn_error(param){
     if(0 === param[0]){var conn_error = param[1]; return conn_error;}
     var err = param[1];
     return caml_call1(Conn_err[3], err);
    }
    function to_error(param){
     if(0 === param[0]){
      var conn_error = param[1];
      return caml_call1(Conn_err[4], conn_error);
     }
     var err = param[1];
     return err;
    }
    var
     Conn_error_or_exception =
       [0, sexp_of_t$1, , equal, join, to_conn_error, to_error];
    function sexp_of_t$2(of_address_015, param){
     var
      conn_023 = param[4],
      next_connect_result_026 = param[5],
      don_t_reconnect_036 = param[10],
      close_finished_034 = param[9],
      close_started_032 = param[8],
      event_bus_030 = param[7],
      event_handler_028 = param[6],
      bnds_016 = 0;
     function _aS_(_a8_){return 0;}
     var
      arg_041 = caml_call1(Sexplib0_Sexp_conv[24], _aS_),
      bnds_016$0 = [0, [1, [0, _f_, [0, arg_041, 0]]], bnds_016];
     function _aT_(_a7_){return 0;}
     var
      arg_039 = caml_call1(Sexplib0_Sexp_conv[24], _aT_),
      bnds_016$1 = [0, [1, [0, _g_, [0, arg_039, 0]]], bnds_016$0],
      arg_037 =
        caml_call2(Async_kernel_Ivar[9], Core[620], don_t_reconnect_036),
      bnds_016$2 = [0, [1, [0, _h_, [0, arg_037, 0]]], bnds_016$1],
      arg_035 =
        caml_call2(Async_kernel_Ivar[9], Core[620], close_finished_034),
      bnds_016$3 = [0, [1, [0, _i_, [0, arg_035, 0]]], bnds_016$2],
      arg_033 = caml_call2(Async_kernel_Ivar[9], Core[620], close_started_032),
      bnds_016$4 = [0, [1, [0, _j_, [0, arg_033, 0]]], bnds_016$3],
      _aU_ = Core[212];
     function _aV_(param){
      function _a5_(_a6_){return 0;}
      return caml_call1(Sexplib0_Sexp_conv[24], _a5_);
     }
     var
      arg_031 = caml_call3(Bus[2], _aV_, _aU_, event_bus_030),
      bnds_016$5 = [0, [1, [0, _k_, [0, arg_031, 0]]], bnds_016$4],
      server_name_005 = event_handler_028[1],
      bnds_004 = 0;
     function _aR_(_a4_){return 0;}
     var
      arg_008 = caml_call1(Sexplib0_Sexp_conv[24], _aR_),
      bnds_004$0 = [0, [1, [0, _a_, [0, arg_008, 0]]], bnds_004],
      arg_006 = caml_call1(Core[558], server_name_005),
      bnds_004$1 = [0, [1, [0, _b_, [0, arg_006, 0]]], bnds_004$0],
      arg_029 = [1, bnds_004$1],
      bnds_016$6 = [0, [1, [0, _l_, [0, arg_029, 0]]], bnds_016$5],
      _aW_ =
        caml_call2(Core_Result[15], Conn$0[4], Conn_error_or_exception[1]),
      arg_027 =
        caml_call2(Async_kernel_Ivar[9], _aW_, next_connect_result_026),
      bnds_016$7 = [0, [1, [0, _m_, [0, arg_027, 0]]], bnds_016$6];
     function _aX_(param){
      if(typeof param === "number") return _n_;
      var v_025 = param[2];
      return [1, [0, _o_, [0, Conn$0[4].call(null, v_025), 0]]];
     }
     var
      arg_024 = caml_call2(Async_kernel_Ivar[9], _aX_, conn_023),
      bnds_016$8 = [0, [1, [0, _p_, [0, arg_024, 0]]], bnds_016$7];
     function _aY_(_a3_){return 0;}
     var
      arg_022 = caml_call1(Sexplib0_Sexp_conv[24], _aY_),
      bnds_016$9 = [0, [1, [0, _q_, [0, arg_022, 0]]], bnds_016$8];
     function _aZ_(_a2_){return 0;}
     var
      arg_020 = caml_call1(Sexplib0_Sexp_conv[24], _aZ_),
      bnds_016$10 = [0, [1, [0, _r_, [0, arg_020, 0]]], bnds_016$9];
     function _a0_(_a1_){return 0;}
     var
      arg_018 = caml_call1(Sexplib0_Sexp_conv[24], _a0_),
      bnds_016$11 = [0, [1, [0, _s_, [0, arg_018, 0]]], bnds_016$10];
     return [1, bnds_016$11];
    }
    function server_name(t){return t[6][1];}
    function handle_event(t, event){
     if(typeof event === "number")
      var _aQ_ = 0 === event ? 0 : 1;
     else
      switch(event[0]){
        case 0:
         var _aQ_ = _t_; break;
        case 1:
         var e = event[1], _aQ_ = [1, e]; break;
        default: var conn = event[1], _aQ_ = [2, conn];
      }
     caml_call2(Bus[12], t[7], _aQ_);
     var on_event = t[6][2];
     return caml_call1(on_event, event);
    }
    function try_connecting_until_successfu(t){
     var previous_address = [0, 0], previous_error = [0, 0];
     function connect(param){
      function _aM_(param){
       if(0 !== param[0]){
        var e = param[1];
        return caml_call1(Async_kernel[20], [1, e]);
       }
       var addr = param[1], match = previous_address[1];
       if(match)
        var
         previous_address$0 = match[1],
         same_as_previous_address =
           caml_call2(t[11], addr, previous_address$0);
       else
        var same_as_previous_address = 0;
       previous_address[1] = [0, addr];
       function _aO_(param){return caml_call1(t[2], addr);}
       var
        _aP_ =
          same_as_previous_address
           ? Async_kernel_Deferred[18]
           : handle_event(t, [0, addr]);
       return caml_call2(Async_kernel[21], _aP_, _aO_);
      }
      var _aN_ = caml_call1(t[1], 0);
      return caml_call2(Async_kernel[21], _aN_, _aM_);
     }
     function loop(param){
      if(caml_call1(Async_kernel_Ivar[18], t[8])){
       caml_call2(Async_kernel_Ivar[14], t[4], -400989606);
       return caml_call1(Async_kernel[20], -400989606);
      }
      if(caml_call1(Async_kernel_Ivar[18], t[10]))
       return caml_call1(Async_kernel[20], -818917400);
      var ready_to_retry_connecting = caml_call1(t[3], 0);
      function _aF_(connect_result){
       caml_call2(Async_kernel_Ivar[14], t[5], connect_result);
       t[5] = caml_call1(Async_kernel_Ivar[12], 0);
       if(0 === connect_result[0]){
        var conn = connect_result[1];
        caml_call2(Async_kernel_Ivar[14], t[4], [0, 17724, conn]);
        return caml_call1
                (Async_kernel[20],
                 [0, 17724, [0, conn, ready_to_retry_connecting]]);
       }
       var err = connect_result[1], match = previous_error[1];
       if(match)
        var
         previous_err = match[1],
         same_as_previous_error =
           Conn_error_or_exception[3].call(null, err, previous_err);
       else
        var same_as_previous_error = 0;
       previous_error[1] = [0, err];
       function _aG_(param){
        function _aI_(param){return loop(0);}
        var
         _aJ_ = [0, caml_call1(Async_kernel_Ivar[19], t[10]), 0],
         _aK_ =
           [0,
            ready_to_retry_connecting,
            [0, caml_call1(Async_kernel_Ivar[19], t[8]), _aJ_]],
         _aL_ = caml_call1(Async_kernel_Deferred[23], _aK_);
        return caml_call2(Async_kernel[21], _aL_, _aI_);
       }
       if(same_as_previous_error)
        var _aH_ = Async_kernel_Deferred[18];
       else
        var
         err$0 = Conn_error_or_exception[5].call(null, err),
         _aH_ = handle_event(t, [1, err$0]);
       return caml_call2(Async_kernel[21], _aH_, _aG_);
      }
      var
       _aC_ = Conn_error_or_exception[4],
       _aD_ =
         caml_call6
          (Async_kernel_Deferred_or_error[38],
           [0, Core[628]],
           0,
           0,
           0,
           0,
           connect),
       _aE_ = caml_call2(Async_kernel[22], _aD_, _aC_);
      return caml_call2(Async_kernel[23][2], _aE_, _aF_);
     }
     return loop(0);
    }
    function abort_reconnecting_with_no_act(t){
     caml_call2(Async_kernel_Ivar[14], t[8], 0);
     caml_call2(Async_kernel_Ivar[14], t[9], 0);
     return caml_call2(Async_kernel_Ivar[14], t[4], -400989606);
    }
    function create
    (server_name, opt, retry_delay, _Y_, _X_, connect, Address, get_address){
     if(opt)
      var sth = opt[1], on_event = sth;
     else
      var on_event = function(param){return Async_kernel_Deferred[18];};
     if(_Y_)
      var sth$0 = _Y_[1], random_state = sth$0;
     else
      var random_state = [0, 389604849, Base_Random[19][1]];
     if(_X_)
      var sth$1 = _X_[1], time_source = sth$1;
     else
      var time_source = caml_call1(Async_kernel_Time_source[10], 0);
     var
      event_handler = [0, server_name, on_event],
      _Z_ = Core[628] ? 0.1 : 10.,
      ___ = caml_call1(Core_Time_ns[1][82], _Z_),
      default_retry_delay = caml_call1(Core_Fn[1], ___),
      non_randomized_delay =
        caml_call2(Core_Option[39], retry_delay, default_retry_delay);
     if(typeof random_state === "number")
      var retry_delay_span = non_randomized_delay;
     else
      var
       random_state$0 = random_state[2],
       retry_delay_span =
         function(param){
          var
           span = caml_call1(non_randomized_delay, 0),
           span$0 = caml_call1(Core_Time_ns[1][89], span),
           distance =
             caml_call2(Base_Random[19][11], random_state$0, span$0 * 0.3),
           wait =
             caml_call1(Base_Random[19][17], random_state$0)
              ? span$0 + distance
              : span$0 - distance;
          return caml_call1(Core_Time_ns[1][82], wait);
         };
     function retry_delay$0(param){
      var _aB_ = caml_call1(retry_delay_span, 0);
      return caml_call2(Async_kernel_Time_source[29], time_source, _aB_);
     }
     var
      _$_ = Address[2],
      _aa_ = Address[1],
      _ab_ = caml_call1(Async_kernel_Ivar[12], 0),
      _ac_ = caml_call1(Async_kernel_Ivar[12], 0),
      _ad_ = caml_call1(Async_kernel_Ivar[12], 0);
     function _ae_(_aA_){return 0;}
     var
      _af_ = 1,
      _ag_ = 0,
      _ah_ = Core[628] ? dummy_src_pos_that_shows_up_in : _z_,
      _ai_ = caml_call5(Bus[7], 0, _ah_, _ag_, _af_, _ae_),
      _aj_ = caml_call1(Async_kernel_Ivar[12], 0),
      t =
        [0,
         get_address,
         connect,
         retry_delay$0,
         caml_call1(Async_kernel_Ivar[12], 0),
         _aj_,
         event_handler,
         _ai_,
         _ad_,
         _ac_,
         _ab_,
         _aa_,
         _$_];
     function _ak_(param){
      function _am_(param){
       function _ao_(param){
        if(typeof param === "number")
         return -400989606 <= param
                 ? caml_call1(Async_kernel[20], _u_)
                 : (abort_reconnecting_with_no_act
                    (t),
                   caml_call1(Async_kernel[20], _v_));
        var
         match = param[2],
         ready_to_retry_connecting = match[2],
         conn = match[1];
        function _aq_(param){
         function _as_(param){
          t[4] = caml_call1(Async_kernel_Ivar[12], 0);
          function _au_(param){
           function _aw_(param){
            return caml_call1(Async_kernel_Ivar[18], t[8])
                    ? (caml_call2(Async_kernel_Ivar[14], t[4], -400989606), _w_)
                    : caml_call1
                       (Async_kernel_Ivar[18], t[10])
                      ? (abort_reconnecting_with_no_act(t), _x_)
                      : _y_;
           }
           var
            _ax_ = [0, caml_call1(Async_kernel_Ivar[19], t[10]), 0],
            _ay_ =
              [0,
               ready_to_retry_connecting,
               [0, caml_call1(Async_kernel_Ivar[19], t[8]), _ax_]],
            _az_ = caml_call1(Async_kernel_Deferred[23], _ay_);
           return caml_call2(Async_kernel[23][3], _az_, _aw_);
          }
          var _av_ = handle_event(t, 1);
          return caml_call2(Async_kernel[23][2], _av_, _au_);
         }
         var _at_ = caml_call1(Conn$0[3], conn);
         return caml_call2(Async_kernel[23][2], _at_, _as_);
        }
        var _ar_ = handle_event(t, [2, conn]);
        return caml_call2(Async_kernel[23][2], _ar_, _aq_);
       }
       var _ap_ = try_connecting_until_successfu(t);
       return caml_call2(Async_kernel[23][2], _ap_, _ao_);
      }
      var _an_ = handle_event(t, 0);
      return caml_call2(Async_kernel[23][2], _an_, _am_);
     }
     var _al_ = caml_call2(Async_kernel_Deferred[31], 0, _ak_);
     caml_call1(Async_kernel[6], _al_);
     return t;
    }
    function connected(t){
     function loop(param){
      var
       d = caml_call1(Async_kernel_Ivar[19], t[4]),
       match = caml_call1(Async_kernel_Deferred[5], d);
      if(! match){
       var
        _W_ =
          function(param){
           if(typeof param === "number")
            return caml_call1(Async_kernel_Deferred[19], 0);
           var conn = param[2];
           return caml_call1(Async_kernel[20], conn);
          };
       return caml_call2(Async_kernel[21], d, _W_);
      }
      var match$0 = match[1];
      if(typeof match$0 === "number")
       return caml_call1(Async_kernel_Deferred[19], 0);
      var conn = match$0[2];
      if(! caml_call1(Conn$0[2], conn))
       return caml_call1(Async_kernel[20], conn);
      var _V_ = caml_call1(Conn$0[3], conn);
      return caml_call2(Async_kernel[21], _V_, loop);
     }
     return loop(0);
    }
    function current_connection(t){
     var
      _U_ = caml_call1(Async_kernel_Ivar[19], t[4]),
      match = caml_call1(Async_kernel_Deferred[5], _U_);
     if(match){
      var match$0 = match[1];
      if(typeof match$0 !== "number"){
       var conn = match$0[2];
       return [0, conn];
      }
     }
     return 0;
    }
    function close_finished$0(t){
     return caml_call1(Async_kernel_Ivar[19], t[9]);
    }
    function is_closed$0(t){return caml_call1(Async_kernel_Ivar[18], t[8]);}
    function close$0(t){
     if(caml_call1(Async_kernel_Ivar[18], t[8])) return close_finished$0(t);
     caml_call2(Async_kernel_Ivar[14], t[8], 0);
     function _Q_(conn_opt){
      function _S_(param){return caml_call2(Async_kernel_Ivar[14], t[9], 0);}
      if(typeof conn_opt === "number")
       var _T_ = Async_kernel_Deferred[18];
      else
       var conn = conn_opt[2], _T_ = caml_call1(Conn$0[1], conn);
      return caml_call2(Async_kernel[22], _T_, _S_);
     }
     var _R_ = caml_call1(Async_kernel_Ivar[19], t[4]);
     return caml_call2(Async_kernel[21], _R_, _Q_);
    }
    var
     _F_ = caml_call1(Sexplib0_Sexp_conv[7], cst_Persistent_connection_clos),
     connected_or_failed_to_connect = caml_call1(Core_Or_error[45], _F_);
    function connected_or_failed_to_connect$0(t){
     if(is_closed$0(t))
      return caml_call1(Async_kernel[20], connected_or_failed_to_connect);
     var match = current_connection(t);
     if(match){
      var x = match[1];
      if(! caml_call1(Conn$0[2], x))
       return caml_call1(Async_kernel[20], [0, x]);
     }
     var _G_ = 0, _H_ = Core_Result[47], _I_ = Conn_error_or_exception[6];
     function _J_(_P_){return caml_call2(_H_, _P_, _I_);}
     var
      _K_ = caml_call1(Async_kernel_Ivar[19], t[5]),
      _L_ = [0, caml_call2(Async_kernel[4], _K_, _J_), _G_];
     function _M_(param){return connected_or_failed_to_connect;}
     var
      _N_ = caml_call1(Async_kernel_Ivar[19], t[8]),
      _O_ = [0, caml_call2(Async_kernel[4], _N_, _M_), _L_];
     return caml_call1(Async_kernel_Deferred[29], _O_);
    }
    function close_when_current_connection_(t){
     return caml_call2(Async_kernel_Ivar[16], t[10], 0);
    }
    var
     Poly =
       [0,
        sexp_of_t$2,
        server_name,
        ,
        ,
        ,
        create,
        connected,
        current_connection,
        close_finished$0,
        is_closed$0,
        close$0,
        ,
        connected_or_failed_to_connect$0,
        close_when_current_connection_];
    function sexp_of_t$3(param){return Poly[1].call(null, param[12], param);}
    function close_when_current_connection_$0(param){return Poly[14].call(null, param);
    }
    function close_finished$1(param){return Poly[9].call(null, param);}
    function is_closed$1(param){return Poly[10].call(null, param);}
    function event_bus(param){return caml_call1(Bus[6], param[7]);}
    function close$1(param){return Poly[11].call(null, param);}
    function server_name$0(param){return Poly[2].call(null, param);}
    function current_connection$0(param){return Poly[8].call(null, param);}
    function connected_or_failed_to_connect$1(param){return Poly[13].call(null, param);
    }
    function connected$0(param){return Poly[7].call(null, param);}
    function create$0
    (server_name,
     on_event,
     retry_delay,
     random_state,
     time_source,
     connect,
     address,
     get_address){
     return Poly[6].call
             (null,
              server_name,
              on_event,
              retry_delay,
              random_state,
              time_source,
              connect,
              address,
              get_address);
    }
    return [0,
            ,
            ,
            Event,
            ,
            ,
            sexp_of_t$3,
            close_when_current_connection_$0,
            close_finished$1,
            is_closed$1,
            event_bus,
            close$1,
            server_name$0,
            current_connection$0,
            connected_or_failed_to_connect$1,
            connected$0,
            create$0];
   }
   caml_call1(Ppx_inline_test_lib[7], cst_persistent_connection_kern);
   caml_call1(Ppx_expect_runtime[1][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Persistent_connection_kern);
   function _A_(Conn){
    var equal = Core_Error[3], sexp_of_t = Core_Error[9];
    function of_exception_error(e){return e;}
    function to_error(e){return e;}
    var _E_ = Make([0, equal, sexp_of_t, of_exception_error, to_error], Conn);
    return [0,
            _E_[6],
            _E_[3],
            _E_[16],
            _E_[15],
            _E_[10],
            _E_[14],
            _E_[13],
            _E_[12],
            _E_[11],
            _E_[9],
            _E_[8],
            _E_[7]];
   }
   var
    Persistent_connection_kernel =
      [0,
       function(_C_, _B_){
        var _D_ = Make(_C_, _B_);
        return [0,
                _D_[6],
                _D_[3],
                _D_[16],
                _D_[15],
                _D_[10],
                _D_[14],
                _D_[13],
                _D_[12],
                _D_[11],
                _D_[9],
                _D_[8],
                _D_[7]];
       },
       _A_];
   runtime.caml_register_global
    (61, Persistent_connection_kernel, cst_Persistent_connection_kern$0);
   return;
  }
  (globalThis));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLjAsImZpbGUiOiJwZXJzaXN0ZW50X2Nvbm5lY3Rpb25fa2VybmVsLmNtYS5qcyIsInNvdXJjZVJvb3QiOiIiLCJuYW1lcyI6WyJzZXhwX29mX3QiLCJvZl9jb25uX2Vycm9yXzAwMiIsIm9mX2FkZHJlc3NfMDAzIiwiYXJnMF8wMDQiLCJyZXMwXzAwNSIsImFyZzBfMDA2IiwicmVzMF8wMDciLCJhcmcwXzAwOCIsInJlczBfMDA5IiwibG9nX2xldmVsIiwiZHVtbXlfc3JjX3Bvc190aGF0X3Nob3dzX3VwX2luIiwic2V4cF9vZl9jb25uX2Vycm9yIiwic2V4cF9vZl90JDAiLCJvZl9hZGRyZXNzXzAwOSIsInhfMDEwIiwic2V4cF9vZl90JDEiLCJhcmcwXzAxMSIsInJlczBfMDEyIiwiYXJnMF8wMTMiLCJyZXMwXzAxNCIsInNhbWVfZXJyb3IiLCJlMSIsImUyIiwidG9fc2V4cCIsImUiLCJlcXVhbCIsImUxJDAiLCJlMiQwIiwiZTEkMSIsImUyJDEiLCJqb2luIiwiZXhuIiwicmVzdWx0IiwiY29ubl9lcnJvciIsInRvX2Nvbm5fZXJyb3IiLCJlcnIiLCJ0b19lcnJvciIsInNleHBfb2ZfdCQyIiwib2ZfYWRkcmVzc18wMTUiLCJjb25uXzAyMyIsIm5leHRfY29ubmVjdF9yZXN1bHRfMDI2IiwiZG9uX3RfcmVjb25uZWN0XzAzNiIsImNsb3NlX2ZpbmlzaGVkXzAzNCIsImNsb3NlX3N0YXJ0ZWRfMDMyIiwiZXZlbnRfYnVzXzAzMCIsImV2ZW50X2hhbmRsZXJfMDI4IiwiYm5kc18wMTYiLCJhcmdfMDQxIiwiYm5kc18wMTYkMCIsImFyZ18wMzkiLCJibmRzXzAxNiQxIiwiYXJnXzAzNyIsImJuZHNfMDE2JDIiLCJhcmdfMDM1IiwiYm5kc18wMTYkMyIsImFyZ18wMzMiLCJibmRzXzAxNiQ0IiwiYXJnXzAzMSIsImJuZHNfMDE2JDUiLCJzZXJ2ZXJfbmFtZV8wMDUiLCJibmRzXzAwNCIsImFyZ18wMDgiLCJibmRzXzAwNCQwIiwiYXJnXzAwNiIsImJuZHNfMDA0JDEiLCJhcmdfMDI5IiwiYm5kc18wMTYkNiIsImFyZ18wMjciLCJibmRzXzAxNiQ3Iiwidl8wMjUiLCJhcmdfMDI0IiwiYm5kc18wMTYkOCIsImFyZ18wMjIiLCJibmRzXzAxNiQ5IiwiYXJnXzAyMCIsImJuZHNfMDE2JDEwIiwiYXJnXzAxOCIsImJuZHNfMDE2JDExIiwic2VydmVyX25hbWUiLCJ0IiwiaGFuZGxlX2V2ZW50IiwiZXZlbnQiLCJjb25uIiwib25fZXZlbnQiLCJ0cnlfY29ubmVjdGluZ191bnRpbF9zdWNjZXNzZnUiLCJwcmV2aW91c19hZGRyZXNzIiwicHJldmlvdXNfZXJyb3IiLCJjb25uZWN0IiwiYWRkciIsInByZXZpb3VzX2FkZHJlc3MkMCIsInNhbWVfYXNfcHJldmlvdXNfYWRkcmVzcyIsImxvb3AiLCJyZWFkeV90b19yZXRyeV9jb25uZWN0aW5nIiwiY29ubmVjdF9yZXN1bHQiLCJwcmV2aW91c19lcnIiLCJzYW1lX2FzX3ByZXZpb3VzX2Vycm9yIiwiZXJyJDAiLCJhYm9ydF9yZWNvbm5lY3Rpbmdfd2l0aF9ub19hY3QiLCJjcmVhdGUiLCJvcHQiLCJyZXRyeV9kZWxheSIsIkFkZHJlc3MiLCJnZXRfYWRkcmVzcyIsInN0aCIsInN0aCQwIiwicmFuZG9tX3N0YXRlIiwic3RoJDEiLCJ0aW1lX3NvdXJjZSIsImV2ZW50X2hhbmRsZXIiLCJkZWZhdWx0X3JldHJ5X2RlbGF5Iiwibm9uX3JhbmRvbWl6ZWRfZGVsYXkiLCJyZXRyeV9kZWxheV9zcGFuIiwicmFuZG9tX3N0YXRlJDAiLCJzcGFuIiwic3BhbiQwIiwiZGlzdGFuY2UiLCJ3YWl0IiwicmV0cnlfZGVsYXkkMCIsImNvbm5lY3RlZCIsImQiLCJjdXJyZW50X2Nvbm5lY3Rpb24iLCJjbG9zZV9maW5pc2hlZCQwIiwiaXNfY2xvc2VkJDAiLCJjbG9zZSQwIiwiY29ubl9vcHQiLCJjb25uZWN0ZWRfb3JfZmFpbGVkX3RvX2Nvbm5lY3QiLCJjb25uZWN0ZWRfb3JfZmFpbGVkX3RvX2Nvbm5lY3QkMCIsIngiLCJjbG9zZV93aGVuX2N1cnJlbnRfY29ubmVjdGlvbl8iLCJzZXhwX29mX3QkMyIsInBhcmFtIiwiY2xvc2Vfd2hlbl9jdXJyZW50X2Nvbm5lY3Rpb25fJDAiLCJjbG9zZV9maW5pc2hlZCQxIiwiaXNfY2xvc2VkJDEiLCJldmVudF9idXMiLCJjbG9zZSQxIiwic2VydmVyX25hbWUkMCIsImN1cnJlbnRfY29ubmVjdGlvbiQwIiwiY29ubmVjdGVkX29yX2ZhaWxlZF90b19jb25uZWN0JDEiLCJjb25uZWN0ZWQkMCIsImNyZWF0ZSQwIiwiYWRkcmVzcyIsIm9mX2V4Y2VwdGlvbl9lcnJvciJdLCJzb3VyY2VzIjpbIi9Vc2Vycy90eWxhbm1vcmFuLy5vcGFtLzUuMS4xL2xpYi9hc3luY19rZXJuZWwvcGVyc2lzdGVudF9jb25uZWN0aW9uX2tlcm5lbC9wZXJzaXN0ZW50X2Nvbm5lY3Rpb25fa2VybmVsX18ubWwiLCIvVXNlcnMvdHlsYW5tb3Jhbi8ub3BhbS81LjEuMS9saWIvYXN5bmNfa2VybmVsL3BlcnNpc3RlbnRfY29ubmVjdGlvbl9rZXJuZWwvZXZlbnQubWwiLCIvVXNlcnMvdHlsYW5tb3Jhbi8ub3BhbS81LjEuMS9saWIvYXN5bmNfa2VybmVsL3BlcnNpc3RlbnRfY29ubmVjdGlvbl9rZXJuZWwvcGVyc2lzdGVudF9jb25uZWN0aW9uX2tlcm5lbC5tbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztHQVF3Qzs7SUFBQTs7Ozs7RTs7Ozs7Ozs7Ozs7O0c7Ozs7O0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0NOeEMsU0FBQUEsdUJBQWFDLG1CQUFhQztJQUExQjs7O09BRUU7UUFBQUM7UUFBQUMsV0FBQSxXQUZ3QkYsZ0JBRXhCQztPQUFBLHdCQUFBQzs7T0FDQTtRQUFBQztRQUFBQyxXQUFBLFdBSFdMLG1CQUdYSTtPQUFBLHdCQUFBQzs7T0FDQTtRQUFBQztRQUFBQyxXQUFBLG1DQUFBRDtPQUFBLHdCQUFBQzs7R0FFa0I7WUFFaEJDO0lBQVksZ0RBRVc7SUFEb0Q7R0FDOUM7Ozs7OzRDQVZqQ1QsV0FRSVM7Ozs7RTs7Ozs7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Ozs7UUFDWjFDO1FBZ0JJeUM7Ozs7UUF3RkFvQjtRQXlGQW9CO1FBc0NBRTtRQU1BQztRQUNBQztRQUVBQzs7UUFtQkFHO1FBZ0JBRTthQU9GQyxZQUFhQyxPQUFLLDBCQUFMQSxXQUFBQTthQUViQyxpQ0FBMkNELE9BQzdDLDJCQUQ2Q0E7O2FBSTNDRSxpQkFBa0JGLE9BQUssMEJBQUxBO2FBQ2xCRyxZQUFhSCxPQUFLLDJCQUFMQTthQUNiSSxVQUFhSixPQUFLLE9BQUEsbUJBQUxBO2FBQ2JLLFFBQVNMLE9BQUssMkJBQUxBO2FBQ1RNLGNBQWVOLE9BQUssMEJBQUxBO2FBQ2ZPLHFCQUFzQlAsT0FBSywwQkFBTEE7YUFDdEJRLGlDQUFrQ1IsT0FBSywyQkFBTEE7O2FBQ2xDUyxZQUFhVCxPQUFLLDBCQUFMQTthQUViVTtLQUNEOUQ7S0FDQUs7S0FDQWlCO0tBQ0FLO0tBQ0FFO0tBQ0FwQjtLQUNBc0Q7S0FDRHZDO0tBRUE7O2NBVEN4QjtjQUNBSztjQUNBaUI7Y0FDQUs7Y0FDQUU7Y0FDQXBCO2NBQ0FzRDtjQUNEdkM7SUFXaUI7SUF6WDBDOzs7Ozs7WUF1VnpEMkI7WUFFQUU7WUFJQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFFQUM7Ozs7Ozs7SUEwQkEsSUFBQW5ILHVCQUFBekI7YUFFSThJLG1CQUFtQnRILEdBQUksT0FBSkEsRUFBSzthQUN4QlksU0FBU1osR0FBSSxPQUFKQSxFQUFLO3VCQUhsQkMsT0FBQXpCLFdBRUk4SSxvQkFDQTFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFIiwic291cmNlc0NvbnRlbnQiOlsiKCogZ2VuZXJhdGVkIGJ5IGR1bmUgKilcblxuKCoqIEBjYW5vbmljYWwgUGVyc2lzdGVudF9jb25uZWN0aW9uX2tlcm5lbC5FdmVudCAqKVxubW9kdWxlIEV2ZW50ID0gUGVyc2lzdGVudF9jb25uZWN0aW9uX2tlcm5lbF9fRXZlbnRcblxuKCoqIEBjYW5vbmljYWwgUGVyc2lzdGVudF9jb25uZWN0aW9uX2tlcm5lbC5QZXJzaXN0ZW50X2Nvbm5lY3Rpb25fa2VybmVsX2ludGYgKilcbm1vZHVsZSBQZXJzaXN0ZW50X2Nvbm5lY3Rpb25fa2VybmVsX2ludGYgPSBQZXJzaXN0ZW50X2Nvbm5lY3Rpb25fa2VybmVsX19QZXJzaXN0ZW50X2Nvbm5lY3Rpb25fa2VybmVsX2ludGZcblxubW9kdWxlIFBlcnNpc3RlbnRfY29ubmVjdGlvbl9rZXJuZWxfXyA9IHN0cnVjdCBlbmRcbltAQGRlcHJlY2F0ZWQgXCJ0aGlzIG1vZHVsZSBpcyBzaGFkb3dlZFwiXVxuIiwib3BlbiEgQ29yZVxuXG50eXBlICgnY29ubiwgJ2Nvbm5fZXJyb3IsICdhZGRyZXNzKSB0ID1cbiAgfCBBdHRlbXB0aW5nX3RvX2Nvbm5lY3RcbiAgfCBPYnRhaW5lZF9hZGRyZXNzIG9mICdhZGRyZXNzXG4gIHwgRmFpbGVkX3RvX2Nvbm5lY3Qgb2YgJ2Nvbm5fZXJyb3JcbiAgfCBDb25uZWN0ZWQgb2YgKCdjb25uW0BzZXhwLm9wYXF1ZV0pXG4gIHwgRGlzY29ubmVjdGVkXG5bQEBkZXJpdmluZyBzZXhwX29mXVxuXG5sZXQgbG9nX2xldmVsID0gZnVuY3Rpb25cbiAgfCBBdHRlbXB0aW5nX3RvX2Nvbm5lY3QgfCBDb25uZWN0ZWQgXyB8IERpc2Nvbm5lY3RlZCB8IE9idGFpbmVkX2FkZHJlc3MgXyAtPiBgSW5mb1xuICB8IEZhaWxlZF90b19jb25uZWN0IF8gLT4gYEVycm9yXG47O1xuIiwib3BlbiEgQ29yZVxub3BlbiEgQXN5bmNfa2VybmVsXG5vcGVuISBBc3luY19rZXJuZWxfcmVxdWlyZV9leHBsaWNpdF90aW1lX3NvdXJjZVxuaW5jbHVkZSBQZXJzaXN0ZW50X2Nvbm5lY3Rpb25fa2VybmVsX2ludGZcbm1vZHVsZSBFdmVudCA9IEV2ZW50XG5cbm1vZHVsZSBFdmVudF9oYW5kbGVyID0gc3RydWN0XG4gIHR5cGUgKCdjb25uLCAnY29ubl9lcnJvciwgJ2FkZHJlc3MpIHQgPVxuICAgIHsgc2VydmVyX25hbWUgOiBzdHJpbmdcbiAgICA7IG9uX2V2ZW50IDogKCdjb25uLCAnY29ubl9lcnJvciwgJ2FkZHJlc3MpIEV2ZW50LnQgLT4gdW5pdCBEZWZlcnJlZC50XG4gICAgfVxuICBbQEBkZXJpdmluZyBzZXhwX29mXVxuXG4gIGxldCBoYW5kbGUgdCB7IHNlcnZlcl9uYW1lID0gXzsgb25fZXZlbnQgfSA9IG9uX2V2ZW50IHRcbmVuZFxuXG4oKiBUaGlzIHBvc2l0aW9uIHNob3dzIHVwIGluIHRlc3RzIGluIGEgd2F5IHRoYXQgaXMgZGlmZmljdWx0IHRvIHN1cHByZXNzLCBzbyB3ZSBkZWZpbmUgaXRcbiAgIGhlcmUgaW4gYSBwbGFjZSB0aGF0IGlzIHVubGlrZWx5IHRvIGNoYW5nZSB2ZXJ5IG9mdGVuICopXG5sZXQgZHVtbXlfc3JjX3Bvc190aGF0X3Nob3dzX3VwX2luX3Rlc3RzID0gWyVoZXJlXVxuXG5tb2R1bGUgTWFrZScgKENvbm5fZXJyIDogQ29ubmVjdGlvbl9lcnJvcikgKENvbm4gOiBDbG9zYWJsZSkgPSBzdHJ1Y3RcbiAgbW9kdWxlIENvbm4gPSBzdHJ1Y3RcbiAgICBpbmNsdWRlIENvbm5cblxuICAgIGxldCBzZXhwX29mX3QgKF8gOiB0KSA6IFNleHAudCA9IEF0b20gXCI8Q29ubi50PlwiXG4gIGVuZFxuXG4gIHR5cGUgY29ubiA9IENvbm4udFxuICB0eXBlIGNvbm5fZXJyb3IgPSBDb25uX2Vyci50IFtAQGRlcml2aW5nIHNleHBfb2ZdXG5cbiAgbW9kdWxlIEV2ZW50ID0gc3RydWN0XG4gICAgdHlwZSAnYWRkcmVzcyB0ID0gKENvbm4udCwgQ29ubl9lcnIudCwgJ2FkZHJlc3MpIEV2ZW50LnQgW0BAZGVyaXZpbmcgc2V4cF9vZl1cbiAgZW5kXG5cbiAgKCogV2UgdXNlIHRoaXMgaGVscGVyIHR5cGUgaW5zdGVhZCBvZiBjYWxsaW5nIFtDb25uX2Vyci5vZl9leGNlcHRpb25fZXJyb3JdIHNvIHRoYXQgd2VcbiAgICAgY2FuIHJlbGlhYmx5IGNhbGwgW3NhbWVfZXJyb3JdIG9uIGV4Y2VwdGlvbnMgcmFpc2VkIGluIFtjb25uZWN0XTogSWZcbiAgICAgW0Nvbm5fZXJyLnRvX2Vycm9yIChDb25uX2Vyci5vZl9leGNlcHRpb25fZXJyb3IgZXJyKV0gZG9lc24ndCByb3VuZHRyaXAgdGhlblxuICAgICBbc2FtZV9lcnJvcl0gbWF5IG5vdCBjb3JyZWN0bHkgZGlzY2FyZCB0aGUgYmFja3RyYWNlIGFuZCB3ZSBjb3VsZCBoYXZlIG5vaXN5IGxvZ3MgKilcbiAgbW9kdWxlIENvbm5fZXJyb3Jfb3JfZXhjZXB0aW9uID0gc3RydWN0XG4gICAgdHlwZSB0ID1cbiAgICAgIHwgQ29ubl9lcnJvciBvZiBjb25uX2Vycm9yXG4gICAgICB8IEV4Y2VwdGlvbiBvZiBFcnJvci50XG4gICAgW0BAZGVyaXZpbmcgc2V4cF9vZl1cblxuICAgICgqIFRoaXMgZnVuY3Rpb24gZm9jdXNlcyBpbiBvbiB0aGUgdGhlIGVycm9yIGl0c2VsZiwgZGlzY2FyZGluZyBpbmZvcm1hdGlvbiBhYm91dCB3aGljaFxuICAgICAgIG1vbml0b3IgY2F1Z2h0IHRoZSBlcnJvciwgaWYgYW55LlxuXG4gICAgICAgSWYgd2UgZG9uJ3QgZG8gdGhpcywgd2Ugc29tZXRpbWVzIGVuZCB1cCB3aXRoIG5vaXN5IGxvZ3Mgd2hpY2ggcmVwb3J0IHRoZSBzYW1lIGVycm9yXG4gICAgICAgYWdhaW4gYW5kIGFnYWluLCBkaWZmZXJpbmcgb25seSBhcyB0byB3aGF0IG1vbml0b3IgY2F1Z2h0IHRoZW0uICopXG4gICAgbGV0IHNhbWVfZXJyb3IgZTEgZTIgPVxuICAgICAgbGV0IHRvX3NleHAgZSA9IEV4bi5zZXhwX29mX3QgKE1vbml0b3IuZXh0cmFjdF9leG4gKEVycm9yLnRvX2V4biBlKSkgaW5cbiAgICAgIFNleHAuZXF1YWwgKHRvX3NleHAgZTEpICh0b19zZXhwIGUyKVxuICAgIDs7XG5cbiAgICBsZXQgZXF1YWwgZTEgZTIgPVxuICAgICAgbWF0Y2ggZTEsIGUyIHdpdGhcbiAgICAgIHwgQ29ubl9lcnJvciBlMSwgQ29ubl9lcnJvciBlMiAtPiBDb25uX2Vyci5lcXVhbCBlMSBlMlxuICAgICAgfCBFeGNlcHRpb24gZTEsIEV4Y2VwdGlvbiBlMiAtPiBzYW1lX2Vycm9yIGUxIGUyXG4gICAgICB8IF8gLT4gZmFsc2VcbiAgICA7O1xuXG4gICAgbGV0IGpvaW4gPSBmdW5jdGlvblxuICAgICAgfCBPayAoT2sgcmVzdWx0KSAtPiBPayByZXN1bHRcbiAgICAgIHwgT2sgKEVycm9yIGNvbm5fZXJyb3IpIC0+IEVycm9yIChDb25uX2Vycm9yIGNvbm5fZXJyb3IpXG4gICAgICB8IEVycm9yIGV4biAtPiBFcnJvciAoRXhjZXB0aW9uIGV4bilcbiAgICA7O1xuXG4gICAgbGV0IHRvX2Nvbm5fZXJyb3IgPSBmdW5jdGlvblxuICAgICAgfCBDb25uX2Vycm9yIGNvbm5fZXJyb3IgLT4gY29ubl9lcnJvclxuICAgICAgfCBFeGNlcHRpb24gZXJyIC0+IENvbm5fZXJyLm9mX2V4Y2VwdGlvbl9lcnJvciBlcnJcbiAgICA7O1xuXG4gICAgbGV0IHRvX2Vycm9yID0gZnVuY3Rpb25cbiAgICAgIHwgQ29ubl9lcnJvciBjb25uX2Vycm9yIC0+IENvbm5fZXJyLnRvX2Vycm9yIGNvbm5fZXJyb3JcbiAgICAgIHwgRXhjZXB0aW9uIGVyciAtPiBlcnJcbiAgICA7O1xuICBlbmRcblxuICAoKiBBIHBlcnNpc3RlbnQgY29ubmVjdGlvbiB0aGF0IGlzIHBvbHltb3JwaGljIGluIHRoZSBhZGRyZXNzIHR5cGUuICBXZSBoaWRlIGF3YXkgdGhpc1xuICAgICB0eXBlIGxhdGVyIHNpbmNlIGl0IG9ubHkgYXBwZWFycyBpbiB0aGUgdHlwZSBvZiBbY3JlYXRlXS4gKilcbiAgbW9kdWxlIFBvbHkgPSBzdHJ1Y3RcbiAgICB0eXBlICdhZGRyZXNzIHQgPVxuICAgICAgeyBnZXRfYWRkcmVzcyA6IHVuaXQgLT4gKCdhZGRyZXNzLCBjb25uX2Vycm9yKSBSZXN1bHQudCBEZWZlcnJlZC50XG4gICAgICA7IGNvbm5lY3QgOiAnYWRkcmVzcyAtPiAoQ29ubi50LCBjb25uX2Vycm9yKSBSZXN1bHQudCBEZWZlcnJlZC50XG4gICAgICA7IHJldHJ5X2RlbGF5IDogdW5pdCAtPiB1bml0IERlZmVycmVkLnRcbiAgICAgIDsgbXV0YWJsZSBjb25uIDogWyBgT2sgb2YgQ29ubi50IHwgYENsb3NlX3N0YXJ0ZWQgXSBJdmFyLnRcbiAgICAgIDsgbXV0YWJsZSBuZXh0X2Nvbm5lY3RfcmVzdWx0IDogKENvbm4udCwgQ29ubl9lcnJvcl9vcl9leGNlcHRpb24udCkgUmVzdWx0LnQgSXZhci50XG4gICAgICA7IGV2ZW50X2hhbmRsZXIgOiAoQ29ubi50LCBjb25uX2Vycm9yLCAnYWRkcmVzcykgRXZlbnRfaGFuZGxlci50XG4gICAgICA7IGV2ZW50X2J1cyA6ICh1bml0IEV2ZW50LnQgLT4gdW5pdCwgcmVhZF93cml0ZSkgQnVzLnRcbiAgICAgIDsgY2xvc2Vfc3RhcnRlZCA6IHVuaXQgSXZhci50XG4gICAgICA7IGNsb3NlX2ZpbmlzaGVkIDogdW5pdCBJdmFyLnRcbiAgICAgIDsgZG9uJ3RfcmVjb25uZWN0IDogdW5pdCBJdmFyLnRcbiAgICAgIDsgYWRkcmVzc19lcXVhbCA6ICdhZGRyZXNzIC0+ICdhZGRyZXNzIC0+IGJvb2xcbiAgICAgIDsgc2V4cF9vZl9hZGRyZXNzIDogJ2FkZHJlc3MgLT4gU2V4cC50XG4gICAgICB9XG4gICAgW0BAZGVyaXZpbmcgc2V4cF9vZl1cblxuICAgIGxldCBzZXJ2ZXJfbmFtZSB0ID0gdC5ldmVudF9oYW5kbGVyLnNlcnZlcl9uYW1lXG5cbiAgICBsZXQgaGFuZGxlX2V2ZW50ICh0eXBlIGFkZHJlc3MpIHQgKGV2ZW50IDogYWRkcmVzcyBFdmVudC50KSA9XG4gICAgICBCdXMud3JpdGVcbiAgICAgICAgdC5ldmVudF9idXNcbiAgICAgICAgKG1hdGNoIGV2ZW50IHdpdGhcbiAgICAgICAgIHwgT2J0YWluZWRfYWRkcmVzcyAoXyA6IGFkZHJlc3MpIC0+IE9idGFpbmVkX2FkZHJlc3MgKClcbiAgICAgICAgIHwgQXR0ZW1wdGluZ190b19jb25uZWN0IC0+IEF0dGVtcHRpbmdfdG9fY29ubmVjdFxuICAgICAgICAgfCBGYWlsZWRfdG9fY29ubmVjdCBlIC0+IEZhaWxlZF90b19jb25uZWN0IGVcbiAgICAgICAgIHwgQ29ubmVjdGVkIGNvbm4gLT4gQ29ubmVjdGVkIGNvbm5cbiAgICAgICAgIHwgRGlzY29ubmVjdGVkIC0+IERpc2Nvbm5lY3RlZCk7XG4gICAgICBFdmVudF9oYW5kbGVyLmhhbmRsZSBldmVudCB0LmV2ZW50X2hhbmRsZXJcbiAgICA7O1xuXG4gICAgKCogQ29udGludWUgdHJ5aW5nIHRvIGNvbm5lY3QgdW50aWwgd2UgYXJlIGFibGUgdG8gZG8gc28sIGluIHdoaWNoIGNhc2Ugd2UgcmV0dXJuIGJvdGhcbiAgICAgICB0aGUgbmV3IGNvbm5lY3Rpb24gYW5kIGEgZGVmZXJyZWQgdGhhdCB3aWxsIGJlY29tZSBkZXRlcm1pbmVkIG9uY2Ugd2UgYXJlIHJlYWR5IGZvclxuICAgICAgIHRoZSBuZXh0IHJlY29ubmVjdGlvbiBhdHRlbXB0LiAqKVxuICAgIGxldCB0cnlfY29ubmVjdGluZ191bnRpbF9zdWNjZXNzZnVsIHQgPVxuICAgICAgKCogV2UgdGFrZSBjYXJlIG5vdCB0byBzcGFtIGxvZ3Mgd2l0aCB0aGUgc2FtZSBtZXNzYWdlIG92ZXIgYW5kIG92ZXIgYnkgY29tcGFyaW5nXG4gICAgICAgICBlYWNoIGxvZyBtZXNzYWdlIHRoZSB0aGUgcHJldmlvdXMgb25lIG9mIHRoZSBzYW1lIHR5cGUuICopXG4gICAgICBsZXQgcHJldmlvdXNfYWRkcmVzcyA9IHJlZiBOb25lIGluXG4gICAgICBsZXQgcHJldmlvdXNfZXJyb3IgPSByZWYgTm9uZSBpblxuICAgICAgbGV0IGNvbm5lY3QgKCkgPVxuICAgICAgICB0LmdldF9hZGRyZXNzICgpXG4gICAgICAgID4+PSBmdW5jdGlvblxuICAgICAgICB8IEVycm9yIGUgLT4gcmV0dXJuIChFcnJvciBlKVxuICAgICAgICB8IE9rIGFkZHIgLT5cbiAgICAgICAgICBsZXQgc2FtZV9hc19wcmV2aW91c19hZGRyZXNzID1cbiAgICAgICAgICAgIG1hdGNoICFwcmV2aW91c19hZGRyZXNzIHdpdGhcbiAgICAgICAgICAgIHwgTm9uZSAtPiBmYWxzZVxuICAgICAgICAgICAgfCBTb21lIHByZXZpb3VzX2FkZHJlc3MgLT4gdC5hZGRyZXNzX2VxdWFsIGFkZHIgcHJldmlvdXNfYWRkcmVzc1xuICAgICAgICAgIGluXG4gICAgICAgICAgcHJldmlvdXNfYWRkcmVzcyA6PSBTb21lIGFkZHI7XG4gICAgICAgICAgKGlmIHNhbWVfYXNfcHJldmlvdXNfYWRkcmVzc1xuICAgICAgICAgICB0aGVuIERlZmVycmVkLnVuaXRcbiAgICAgICAgICAgZWxzZSBoYW5kbGVfZXZlbnQgdCAoT2J0YWluZWRfYWRkcmVzcyBhZGRyKSlcbiAgICAgICAgICA+Pj0gZnVuICgpIC0+IHQuY29ubmVjdCBhZGRyXG4gICAgICBpblxuICAgICAgbGV0IGNvbm5lY3QgKCkgPVxuICAgICAgICAoKiBDYXRjaCBleGNlcHRpb25zIHJhaXNlZCBieSB0aGUgdXNlci1wcm92aWRlZCBbdC5nZXRfYWRkcmVzc10gb3IgW3QuY29ubmVjdF0gKilcbiAgICAgICAgRGVmZXJyZWQuT3JfZXJyb3IudHJ5X3dpdGggfmV4dHJhY3RfZXhuOmFtX3J1bm5pbmdfdGVzdCBjb25uZWN0XG4gICAgICAgID4+fCBDb25uX2Vycm9yX29yX2V4Y2VwdGlvbi5qb2luXG4gICAgICBpblxuICAgICAgbGV0IHJlYyBsb29wICgpID1cbiAgICAgICAgaWYgSXZhci5pc19mdWxsIHQuY2xvc2Vfc3RhcnRlZFxuICAgICAgICB0aGVuIChcbiAgICAgICAgICBJdmFyLmZpbGxfZXhuIHQuY29ubiBgQ2xvc2Vfc3RhcnRlZDtcbiAgICAgICAgICByZXR1cm4gYENsb3NlX3N0YXJ0ZWQpXG4gICAgICAgIGVsc2UgaWYgSXZhci5pc19mdWxsIHQuZG9uJ3RfcmVjb25uZWN0XG4gICAgICAgIHRoZW4gcmV0dXJuIGBEb24ndF9yZWNvbm5lY3RcbiAgICAgICAgZWxzZSAoXG4gICAgICAgICAgbGV0IHJlYWR5X3RvX3JldHJ5X2Nvbm5lY3RpbmcgPSB0LnJldHJ5X2RlbGF5ICgpIGluXG4gICAgICAgICAgbGV0JWJpbmQgY29ubmVjdF9yZXN1bHQgPSBjb25uZWN0ICgpIGluXG4gICAgICAgICAgSXZhci5maWxsX2V4biB0Lm5leHRfY29ubmVjdF9yZXN1bHQgY29ubmVjdF9yZXN1bHQ7XG4gICAgICAgICAgdC5uZXh0X2Nvbm5lY3RfcmVzdWx0IDwtIEl2YXIuY3JlYXRlICgpO1xuICAgICAgICAgIG1hdGNoIGNvbm5lY3RfcmVzdWx0IHdpdGhcbiAgICAgICAgICB8IE9rIGNvbm4gLT5cbiAgICAgICAgICAgIEl2YXIuZmlsbF9leG4gdC5jb25uIChgT2sgY29ubik7XG4gICAgICAgICAgICByZXR1cm4gKGBPayAoY29ubiwgcmVhZHlfdG9fcmV0cnlfY29ubmVjdGluZykpXG4gICAgICAgICAgfCBFcnJvciBlcnIgLT5cbiAgICAgICAgICAgIGxldCBzYW1lX2FzX3ByZXZpb3VzX2Vycm9yID1cbiAgICAgICAgICAgICAgbWF0Y2ggIXByZXZpb3VzX2Vycm9yIHdpdGhcbiAgICAgICAgICAgICAgfCBOb25lIC0+IGZhbHNlXG4gICAgICAgICAgICAgIHwgU29tZSBwcmV2aW91c19lcnIgLT4gQ29ubl9lcnJvcl9vcl9leGNlcHRpb24uZXF1YWwgZXJyIHByZXZpb3VzX2VyclxuICAgICAgICAgICAgaW5cbiAgICAgICAgICAgIHByZXZpb3VzX2Vycm9yIDo9IFNvbWUgZXJyO1xuICAgICAgICAgICAgKGlmIHNhbWVfYXNfcHJldmlvdXNfZXJyb3JcbiAgICAgICAgICAgICB0aGVuIERlZmVycmVkLnVuaXRcbiAgICAgICAgICAgICBlbHNlIChcbiAgICAgICAgICAgICAgIGxldCBlcnIgPSBDb25uX2Vycm9yX29yX2V4Y2VwdGlvbi50b19jb25uX2Vycm9yIGVyciBpblxuICAgICAgICAgICAgICAgaGFuZGxlX2V2ZW50IHQgKEZhaWxlZF90b19jb25uZWN0IGVycikpKVxuICAgICAgICAgICAgPj49IGZ1biAoKSAtPlxuICAgICAgICAgICAgRGVmZXJyZWQuYW55XG4gICAgICAgICAgICAgIFsgcmVhZHlfdG9fcmV0cnlfY29ubmVjdGluZ1xuICAgICAgICAgICAgICA7IEl2YXIucmVhZCB0LmNsb3NlX3N0YXJ0ZWRcbiAgICAgICAgICAgICAgOyBJdmFyLnJlYWQgdC5kb24ndF9yZWNvbm5lY3RcbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgPj49IGZ1biAoKSAtPiBsb29wICgpKVxuICAgICAgaW5cbiAgICAgIGxvb3AgKClcbiAgICA7O1xuXG4gICAgbGV0IGFib3J0X3JlY29ubmVjdGluZ193aXRoX25vX2FjdGl2ZV9jb25uZWN0aW9uIHQgPVxuICAgICAgSXZhci5maWxsX2V4biB0LmNsb3NlX3N0YXJ0ZWQgKCk7XG4gICAgICBJdmFyLmZpbGxfZXhuIHQuY2xvc2VfZmluaXNoZWQgKCk7XG4gICAgICBJdmFyLmZpbGxfZXhuIHQuY29ubiBgQ2xvc2Vfc3RhcnRlZFxuICAgIDs7XG5cbiAgICBsZXQgY3JlYXRlXG4gICAgICAodHlwZSBhZGRyZXNzKVxuICAgICAgfnNlcnZlcl9uYW1lXG4gICAgICA/KG9uX2V2ZW50ID0gZnVuIF8gLT4gRGVmZXJyZWQudW5pdClcbiAgICAgID9yZXRyeV9kZWxheVxuICAgICAgPyhyYW5kb21fc3RhdGUgPSBgU3RhdGUgUmFuZG9tLlN0YXRlLmRlZmF1bHQpXG4gICAgICA/KHRpbWVfc291cmNlID0gVGltZV9zb3VyY2Uud2FsbF9jbG9jayAoKSlcbiAgICAgIH5jb25uZWN0XG4gICAgICB+YWRkcmVzczoobW9kdWxlIEFkZHJlc3MgOiBBZGRyZXNzIHdpdGggdHlwZSB0ID0gYWRkcmVzcylcbiAgICAgIGdldF9hZGRyZXNzXG4gICAgICA9XG4gICAgICBsZXQgZXZlbnRfaGFuZGxlciA9IHsgRXZlbnRfaGFuZGxlci5zZXJ2ZXJfbmFtZTsgb25fZXZlbnQgfSBpblxuICAgICAgbGV0IGRlZmF1bHRfcmV0cnlfZGVsYXkgPVxuICAgICAgICBGbi5jb25zdCAoVGltZV9ucy5TcGFuLm9mX3NlYyAoaWYgYW1fcnVubmluZ190ZXN0IHRoZW4gMC4xIGVsc2UgMTAuKSlcbiAgICAgIGluXG4gICAgICBsZXQgbm9uX3JhbmRvbWl6ZWRfZGVsYXkgPSBPcHRpb24udmFsdWUgcmV0cnlfZGVsYXkgfmRlZmF1bHQ6ZGVmYXVsdF9yZXRyeV9kZWxheSBpblxuICAgICAgbGV0IHJldHJ5X2RlbGF5X3NwYW4gPVxuICAgICAgICBtYXRjaCByYW5kb21fc3RhdGUgd2l0aFxuICAgICAgICB8IGBOb25fcmFuZG9tIC0+IG5vbl9yYW5kb21pemVkX2RlbGF5XG4gICAgICAgIHwgYFN0YXRlIHJhbmRvbV9zdGF0ZSAtPlxuICAgICAgICAgIGZ1biAoKSAtPlxuICAgICAgICAgICAgbGV0IHNwYW4gPSBub25fcmFuZG9taXplZF9kZWxheSAoKSBpblxuICAgICAgICAgICAgbGV0IHNwYW4gPSBUaW1lX25zLlNwYW4udG9fc2VjIHNwYW4gaW5cbiAgICAgICAgICAgIGxldCBkaXN0YW5jZSA9IFJhbmRvbS5TdGF0ZS5mbG9hdCByYW5kb21fc3RhdGUgKHNwYW4gKi4gMC4zKSBpblxuICAgICAgICAgICAgbGV0IHdhaXQgPVxuICAgICAgICAgICAgICBpZiBSYW5kb20uU3RhdGUuYm9vbCByYW5kb21fc3RhdGVcbiAgICAgICAgICAgICAgdGhlbiBzcGFuICsuIGRpc3RhbmNlXG4gICAgICAgICAgICAgIGVsc2Ugc3BhbiAtLiBkaXN0YW5jZVxuICAgICAgICAgICAgaW5cbiAgICAgICAgICAgIFRpbWVfbnMuU3Bhbi5vZl9zZWMgd2FpdFxuICAgICAgaW5cbiAgICAgIGxldCByZXRyeV9kZWxheSAoKSA9IFRpbWVfc291cmNlLmFmdGVyIHRpbWVfc291cmNlIChyZXRyeV9kZWxheV9zcGFuICgpKSBpblxuICAgICAgbGV0IHQgPVxuICAgICAgICB7IGV2ZW50X2hhbmRsZXJcbiAgICAgICAgOyBldmVudF9idXMgPVxuICAgICAgICAgICAgQnVzLmNyZWF0ZV9leG5cbiAgICAgICAgICAgICAgKGlmIGFtX3J1bm5pbmdfdGVzdCB0aGVuIGR1bW15X3NyY19wb3NfdGhhdF9zaG93c191cF9pbl90ZXN0cyBlbHNlIFslaGVyZV0pXG4gICAgICAgICAgICAgIEFyaXR5MVxuICAgICAgICAgICAgICB+b25fc3Vic2NyaXB0aW9uX2FmdGVyX2ZpcnN0X3dyaXRlOkFsbG93X2FuZF9zZW5kX2xhc3RfdmFsdWVcbiAgICAgICAgICAgICAgfm9uX2NhbGxiYWNrX3JhaXNlOmlnbm9yZVxuICAgICAgICA7IGdldF9hZGRyZXNzXG4gICAgICAgIDsgY29ubmVjdFxuICAgICAgICA7IG5leHRfY29ubmVjdF9yZXN1bHQgPSBJdmFyLmNyZWF0ZSAoKVxuICAgICAgICA7IHJldHJ5X2RlbGF5XG4gICAgICAgIDsgY29ubiA9IEl2YXIuY3JlYXRlICgpXG4gICAgICAgIDsgY2xvc2Vfc3RhcnRlZCA9IEl2YXIuY3JlYXRlICgpXG4gICAgICAgIDsgY2xvc2VfZmluaXNoZWQgPSBJdmFyLmNyZWF0ZSAoKVxuICAgICAgICA7IGRvbid0X3JlY29ubmVjdCA9IEl2YXIuY3JlYXRlICgpXG4gICAgICAgIDsgYWRkcmVzc19lcXVhbCA9IEFkZHJlc3MuZXF1YWxcbiAgICAgICAgOyBzZXhwX29mX2FkZHJlc3MgPSBBZGRyZXNzLnNleHBfb2ZfdFxuICAgICAgICB9XG4gICAgICBpblxuICAgICAgKCogdGhpcyBsb29wIGZpbmlzaGVzIG9uY2UgW2Nsb3NlIHRdIGhhcyBiZWVuIGNhbGxlZCwgaW4gd2hpY2ggY2FzZSBpdCBtYWtlcyBzdXJlIHRvXG4gICAgICAgICBsZWF2ZSBbdC5jb25uXSBmaWxsZWQgd2l0aCBbYENsb3NlX3N0YXJ0ZWRdLiAqKVxuICAgICAgZG9uJ3Rfd2FpdF9mb3JcbiAgICAgIEBAIERlZmVycmVkLnJlcGVhdF91bnRpbF9maW5pc2hlZCAoKSAoZnVuICgpIC0+XG4gICAgICAgICAgIGxldCViaW5kICgpID0gaGFuZGxlX2V2ZW50IHQgQXR0ZW1wdGluZ190b19jb25uZWN0IGluXG4gICAgICAgICAgIG1hdGNoJWJpbmQgdHJ5X2Nvbm5lY3RpbmdfdW50aWxfc3VjY2Vzc2Z1bCB0IHdpdGhcbiAgICAgICAgICAgfCBgQ2xvc2Vfc3RhcnRlZCAtPiByZXR1cm4gKGBGaW5pc2hlZCAoKSlcbiAgICAgICAgICAgfCBgRG9uJ3RfcmVjb25uZWN0IC0+XG4gICAgICAgICAgICAgYWJvcnRfcmVjb25uZWN0aW5nX3dpdGhfbm9fYWN0aXZlX2Nvbm5lY3Rpb24gdDtcbiAgICAgICAgICAgICByZXR1cm4gKGBGaW5pc2hlZCAoKSlcbiAgICAgICAgICAgfCBgT2sgKGNvbm4sIHJlYWR5X3RvX3JldHJ5X2Nvbm5lY3RpbmcpIC0+XG4gICAgICAgICAgICAgbGV0JWJpbmQgKCkgPSBoYW5kbGVfZXZlbnQgdCAoQ29ubmVjdGVkIGNvbm4pIGluXG4gICAgICAgICAgICAgbGV0JWJpbmQgKCkgPSBDb25uLmNsb3NlX2ZpbmlzaGVkIGNvbm4gaW5cbiAgICAgICAgICAgICB0LmNvbm4gPC0gSXZhci5jcmVhdGUgKCk7XG4gICAgICAgICAgICAgbGV0JWJpbmQgKCkgPSBoYW5kbGVfZXZlbnQgdCBEaXNjb25uZWN0ZWQgaW5cbiAgICAgICAgICAgICAoKiB3YWl0cyB1bnRpbCBbcmV0cnlfZGVsYXkgKCldIHRpbWUgaGFzIHBhc3NlZCBzaW5jZSB0aGUgdGltZSBqdXN0IGJlZm9yZSB3ZSBsYXN0XG4gICAgICAgICAgICAgdHJpZWQgdG8gY29ubmVjdCByYXRoZXIgdGhhbiB0aGUgdGltZSB3ZSBub3RpY2VkIGJlaW5nIGRpc2Nvbm5lY3RlZCwgc28gdGhhdCBpZlxuICAgICAgICAgICAgIGEgbG9uZy1saXZlZCBjb25uZWN0aW9uIGRpZXMsIHdlIHdpbGwgYXR0ZW1wdCB0byByZWNvbm5lY3QgaW1tZWRpYXRlbHkuICopXG4gICAgICAgICAgICAgbGV0JW1hcCAoKSA9XG4gICAgICAgICAgICAgICBEZWZlcnJlZC5hbnlcbiAgICAgICAgICAgICAgICAgWyByZWFkeV90b19yZXRyeV9jb25uZWN0aW5nXG4gICAgICAgICAgICAgICAgIDsgSXZhci5yZWFkIHQuY2xvc2Vfc3RhcnRlZFxuICAgICAgICAgICAgICAgICA7IEl2YXIucmVhZCB0LmRvbid0X3JlY29ubmVjdFxuICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgaW5cbiAgICAgICAgICAgICBpZiBJdmFyLmlzX2Z1bGwgdC5jbG9zZV9zdGFydGVkXG4gICAgICAgICAgICAgdGhlbiAoXG4gICAgICAgICAgICAgICBJdmFyLmZpbGxfZXhuIHQuY29ubiBgQ2xvc2Vfc3RhcnRlZDtcbiAgICAgICAgICAgICAgIGBGaW5pc2hlZCAoKSlcbiAgICAgICAgICAgICBlbHNlIGlmIEl2YXIuaXNfZnVsbCB0LmRvbid0X3JlY29ubmVjdFxuICAgICAgICAgICAgIHRoZW4gKFxuICAgICAgICAgICAgICAgYWJvcnRfcmVjb25uZWN0aW5nX3dpdGhfbm9fYWN0aXZlX2Nvbm5lY3Rpb24gdDtcbiAgICAgICAgICAgICAgIGBGaW5pc2hlZCAoKSlcbiAgICAgICAgICAgICBlbHNlIGBSZXBlYXQgKCkpO1xuICAgICAgdFxuICAgIDs7XG5cbiAgICBsZXQgY29ubmVjdGVkIHQgPVxuICAgICAgKCogVGFrZSBjYXJlIG5vdCB0byByZXR1cm4gYSBjb25uZWN0aW9uIHRoYXQgaXMga25vd24gdG8gYmUgY2xvc2VkIGF0IHRoZSB0aW1lXG4gICAgICAgICBbY29ubmVjdGVkXSB3YXMgY2FsbGVkLiAgVGhpcyBjb3VsZCBoYXBwZW4gaW4gY2xpZW50IGNvZGUgdGhhdCBiZWhhdmVzIGxpa2VcbiAgICAgICAgIHtbXG4gICAgICAgICAgIFBlcnNpc3RlbnRfY29ubmVjdGlvbi5ScGMuY29ubmVjdGVkIHRcbiAgICAgICAgICAgPj49IGZ1biBjMSAtPlxuICAgICAgICAgICAuLi5cbiAgICAgICAgICAgICBScGMuQ29ubmVjdGlvbi5jbG9zZV9maW5pc2hlZCBjMVxuICAgICAgICAgICAoKiBhdCB0aGlzIHBvaW50IHdlIGFyZSBpbiBhIHJhY2Ugd2l0aCB0aGUgc2FtZSBjYWxsIGluc2lkZVxuICAgICAgICAgICAgICBwZXJzaXN0ZW50X2NsaWVudC5tbCAqKVxuICAgICAgICAgICA+Pj0gZnVuICgpIC0+XG4gICAgICAgICAgIFBlcnNpc3RlbnRfY29ubmVjdGlvbi5ScGMuY29ubmVjdGVkIHRcbiAgICAgICAgICAgKCogZGVwZW5kaW5nIG9uIGhvdyB0aGUgcmFjZSB0dXJucyBvdXQsIHdlIGRvbid0IHdhbnQgdG8gZ2V0IGEgY2xvc2VkIGNvbm5lY3Rpb25cbiAgICAgICAgICAgICAgaGVyZSAqKVxuICAgICAgICAgICA+Pj0gZnVuIGMyIC0+XG4gICAgICAgICAgIC4uLlxuICAgICAgICAgXX1cbiAgICAgICAgIFRoaXMgZG9lc24ndCByZW1vdmUgdGhlIHJhY2UgY29uZGl0aW9uLCBidXQgaXQgbWFrZXMgaXQgbGVzcyBsaWtlbHkgdG8gaGFwcGVuLlxuICAgICAgKilcbiAgICAgIGxldCByZWMgbG9vcCAoKSA9XG4gICAgICAgIGxldCBkID0gSXZhci5yZWFkIHQuY29ubiBpblxuICAgICAgICBtYXRjaCBEZWZlcnJlZC5wZWVrIGQgd2l0aFxuICAgICAgICB8IE5vbmUgLT5cbiAgICAgICAgICBkXG4gICAgICAgICAgPj49IChmdW5jdGlvblxuICAgICAgICAgIHwgYENsb3NlX3N0YXJ0ZWQgLT4gRGVmZXJyZWQubmV2ZXIgKClcbiAgICAgICAgICB8IGBPayBjb25uIC0+IHJldHVybiBjb25uKVxuICAgICAgICB8IFNvbWUgYENsb3NlX3N0YXJ0ZWQgLT4gRGVmZXJyZWQubmV2ZXIgKClcbiAgICAgICAgfCBTb21lIChgT2sgY29ubikgLT5cbiAgICAgICAgICBpZiBDb25uLmlzX2Nsb3NlZCBjb25uXG4gICAgICAgICAgdGhlblxuICAgICAgICAgICAgKCogZ2l2ZSB0aGUgcmVjb25uZWN0aW9uIGxvb3AgYSBjaGFuY2UgdG8gb3ZlcndyaXRlIHRoZSBpdmFyICopXG4gICAgICAgICAgICBDb25uLmNsb3NlX2ZpbmlzaGVkIGNvbm4gPj49IGxvb3BcbiAgICAgICAgICBlbHNlIHJldHVybiBjb25uXG4gICAgICBpblxuICAgICAgbG9vcCAoKVxuICAgIDs7XG5cbiAgICBsZXQgY3VycmVudF9jb25uZWN0aW9uIHQgPVxuICAgICAgbWF0Y2ggRGVmZXJyZWQucGVlayAoSXZhci5yZWFkIHQuY29ubikgd2l0aFxuICAgICAgfCBOb25lIHwgU29tZSBgQ2xvc2Vfc3RhcnRlZCAtPiBOb25lXG4gICAgICB8IFNvbWUgKGBPayBjb25uKSAtPiBTb21lIGNvbm5cbiAgICA7O1xuXG4gICAgbGV0IGNsb3NlX2ZpbmlzaGVkIHQgPSBJdmFyLnJlYWQgdC5jbG9zZV9maW5pc2hlZFxuICAgIGxldCBpc19jbG9zZWQgdCA9IEl2YXIuaXNfZnVsbCB0LmNsb3NlX3N0YXJ0ZWRcblxuICAgIGxldCBjbG9zZSB0ID1cbiAgICAgIGlmIEl2YXIuaXNfZnVsbCB0LmNsb3NlX3N0YXJ0ZWRcbiAgICAgIHRoZW5cbiAgICAgICAgKCogQW5vdGhlciBjYWxsIHRvIGNsb3NlIGlzIGFscmVhZHkgaW4gcHJvZ3Jlc3MuICBXYWl0IGZvciBpdCB0byBmaW5pc2guICopXG4gICAgICAgIGNsb3NlX2ZpbmlzaGVkIHRcbiAgICAgIGVsc2UgKFxuICAgICAgICBJdmFyLmZpbGxfZXhuIHQuY2xvc2Vfc3RhcnRlZCAoKTtcbiAgICAgICAgSXZhci5yZWFkIHQuY29ublxuICAgICAgICA+Pj0gZnVuIGNvbm5fb3B0IC0+XG4gICAgICAgIChtYXRjaCBjb25uX29wdCB3aXRoXG4gICAgICAgICB8IGBDbG9zZV9zdGFydGVkIC0+IERlZmVycmVkLnVuaXRcbiAgICAgICAgIHwgYE9rIGNvbm4gLT4gQ29ubi5jbG9zZSBjb25uKVxuICAgICAgICA+PnwgZnVuICgpIC0+IEl2YXIuZmlsbF9leG4gdC5jbG9zZV9maW5pc2hlZCAoKSlcbiAgICA7O1xuXG4gICAgbGV0IGNvbm5lY3RlZF9vcl9mYWlsZWRfdG9fY29ubmVjdF9jb25uZWN0aW9uX2Nsb3NlZCA9XG4gICAgICBPcl9lcnJvci5lcnJvcl9zIFslbWVzc2FnZSBcIlBlcnNpc3RlbnQgY29ubmVjdGlvbiBjbG9zZWRcIl1cbiAgICA7O1xuXG4gICAgbGV0IGNvbm5lY3RlZF9vcl9mYWlsZWRfdG9fY29ubmVjdCB0ID1cbiAgICAgIGlmIGlzX2Nsb3NlZCB0XG4gICAgICB0aGVuIHJldHVybiBjb25uZWN0ZWRfb3JfZmFpbGVkX3RvX2Nvbm5lY3RfY29ubmVjdGlvbl9jbG9zZWRcbiAgICAgIGVsc2UgKFxuICAgICAgICBtYXRjaCBjdXJyZW50X2Nvbm5lY3Rpb24gdCB3aXRoXG4gICAgICAgIHwgU29tZSB4IHdoZW4gbm90IChDb25uLmlzX2Nsb3NlZCB4KSAtPiByZXR1cm4gKE9rIHgpXG4gICAgICAgIHwgU29tZSAoXyA6IENvbm4udCkgfCBOb25lIC0+XG4gICAgICAgICAgRGVmZXJyZWQuY2hvb3NlXG4gICAgICAgICAgICBbIGNob2ljZSAoSXZhci5yZWFkIHQuY2xvc2Vfc3RhcnRlZCkgKGZ1biAoKSAtPlxuICAgICAgICAgICAgICAgIGNvbm5lY3RlZF9vcl9mYWlsZWRfdG9fY29ubmVjdF9jb25uZWN0aW9uX2Nsb3NlZClcbiAgICAgICAgICAgIDsgY2hvaWNlXG4gICAgICAgICAgICAgICAgKEl2YXIucmVhZCB0Lm5leHRfY29ubmVjdF9yZXN1bHQpXG4gICAgICAgICAgICAgICAgKFJlc3VsdC5tYXBfZXJyb3IgfmY6Q29ubl9lcnJvcl9vcl9leGNlcHRpb24udG9fZXJyb3IpXG4gICAgICAgICAgICBdKVxuICAgIDs7XG5cbiAgICBsZXQgY2xvc2Vfd2hlbl9jdXJyZW50X2Nvbm5lY3Rpb25faXNfY2xvc2VkIHQgPVxuICAgICAgSXZhci5maWxsX2lmX2VtcHR5IHQuZG9uJ3RfcmVjb25uZWN0ICgpXG4gICAgOztcbiAgZW5kXG5cbiAgdHlwZSB0ID0gVCA6ICdhZGRyZXNzIFBvbHkudCAtPiB0IFtAQHVuYm94ZWRdXG5cbiAgbGV0IHNleHBfb2ZfdCAoVCB0KSA9IFBvbHkuc2V4cF9vZl90IHQuc2V4cF9vZl9hZGRyZXNzIHRcblxuICBsZXQgY2xvc2Vfd2hlbl9jdXJyZW50X2Nvbm5lY3Rpb25faXNfY2xvc2VkIChUIHQpID1cbiAgICBQb2x5LmNsb3NlX3doZW5fY3VycmVudF9jb25uZWN0aW9uX2lzX2Nsb3NlZCB0XG4gIDs7XG5cbiAgbGV0IGNsb3NlX2ZpbmlzaGVkIChUIHQpID0gUG9seS5jbG9zZV9maW5pc2hlZCB0XG4gIGxldCBpc19jbG9zZWQgKFQgdCkgPSBQb2x5LmlzX2Nsb3NlZCB0XG4gIGxldCBldmVudF9idXMgKFQgdCkgPSBCdXMucmVhZF9vbmx5IHQuZXZlbnRfYnVzXG4gIGxldCBjbG9zZSAoVCB0KSA9IFBvbHkuY2xvc2UgdFxuICBsZXQgc2VydmVyX25hbWUgKFQgdCkgPSBQb2x5LnNlcnZlcl9uYW1lIHRcbiAgbGV0IGN1cnJlbnRfY29ubmVjdGlvbiAoVCB0KSA9IFBvbHkuY3VycmVudF9jb25uZWN0aW9uIHRcbiAgbGV0IGNvbm5lY3RlZF9vcl9mYWlsZWRfdG9fY29ubmVjdCAoVCB0KSA9IFBvbHkuY29ubmVjdGVkX29yX2ZhaWxlZF90b19jb25uZWN0IHRcbiAgbGV0IGNvbm5lY3RlZCAoVCB0KSA9IFBvbHkuY29ubmVjdGVkIHRcblxuICBsZXQgY3JlYXRlXG4gICAgfnNlcnZlcl9uYW1lXG4gICAgP29uX2V2ZW50XG4gICAgP3JldHJ5X2RlbGF5XG4gICAgP3JhbmRvbV9zdGF0ZVxuICAgID90aW1lX3NvdXJjZVxuICAgIH5jb25uZWN0XG4gICAgfmFkZHJlc3NcbiAgICBnZXRfYWRkcmVzc1xuICAgID1cbiAgICBUXG4gICAgICAoUG9seS5jcmVhdGVcbiAgICAgICAgIH5zZXJ2ZXJfbmFtZVxuICAgICAgICAgP29uX2V2ZW50XG4gICAgICAgICA/cmV0cnlfZGVsYXlcbiAgICAgICAgID9yYW5kb21fc3RhdGVcbiAgICAgICAgID90aW1lX3NvdXJjZVxuICAgICAgICAgfmNvbm5lY3RcbiAgICAgICAgIH5hZGRyZXNzXG4gICAgICAgICBnZXRfYWRkcmVzcylcbiAgOztcbmVuZFxuXG5tb2R1bGUgTWFrZSAoQ29ubiA6IENsb3NhYmxlKSA9XG4gIE1ha2UnXG4gICAgKHN0cnVjdFxuICAgICAgdHlwZSB0ID0gRXJyb3IudCBbQEBkZXJpdmluZyBlcXVhbCwgc2V4cF9vZl1cblxuICAgICAgbGV0IG9mX2V4Y2VwdGlvbl9lcnJvciBlID0gZVxuICAgICAgbGV0IHRvX2Vycm9yIGUgPSBlXG4gICAgZW5kKVxuICAgIChDb25uKVxuIl19
